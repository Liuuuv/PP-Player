# Documentation Technique - Module Artist Tab

## Architecture du module

Le module `artist_tab` est maintenant complètement autonome et indépendant. Il suit une architecture modulaire claire avec séparation des responsabilités.

### Structure des fichiers

```
artist_tab/
├── __init__.py          # Point d'entrée, imports centralisés
├── config.py            # Configuration spécifique au module
├── utils.py             # Fonctions utilitaires internes
├── main.py              # Module principal avec ArtistTabModule
├── core.py              # Fonctions principales et gestion des onglets
├── songs.py             # Gestion des vidéos/musiques d'artiste
├── releases.py          # Gestion des albums et singles
├── playlists.py         # Gestion des playlists d'artiste
├── README.md            # Documentation utilisateur
└── TECHNICAL_DOC.md     # Cette documentation technique
```

## Indépendance du module

### Imports centralisés
Tous les imports nécessaires sont centralisés dans `__init__.py` :
- Bibliothèques standard (tkinter, threading, etc.)
- Bibliothèques externes (pygame, PIL, yt-dlp, etc.)
- Modules du projet principal (config, setup, etc.)
- Configuration spécifique (`config.py`)
- Utilitaires internes (`utils.py`)

### Fonctions utilitaires internes
Le fichier `utils.py` contient des versions internes des fonctions couramment utilisées :
- `truncate_text_for_display()` - Troncature intelligente de texte
- `format_duration()` - Formatage des durées
- `format_view_count()` - Formatage des nombres de vues
- `create_back_button()` - Création de boutons de retour standardisés
- `show_loading_message()` - Affichage de messages de chargement
- `clear_container()` - Nettoyage de conteneurs

### Configuration autonome
Le fichier `config.py` contient toute la configuration spécifique :
- Couleurs et thèmes
- Dimensions et espacements
- Options de recherche YouTube
- Messages d'interface
- Limites et paramètres

## Flux de données

### 1. Initialisation
```
main.py (MusicPlayer) 
    ↓
artist_tab_manager.py (ArtistTabManager)
    ↓
artist_tab/core.py (_show_artist_content)
```

### 2. Recherche de contenu
```
core.py (_search_artist_content_async)
    ↓
core.py (_find_artist_channel_id)
    ↓
Recherches parallèles:
├── songs.py (_search_artist_videos_with_id)
├── releases.py (_search_artist_releases_with_id)
└── playlists.py (_search_artist_playlists_with_id)
```

### 3. Affichage des résultats
```
Chaque module (songs/releases/playlists)
    ↓
core.py (_display_results_in_batches)
    ↓
Interface utilisateur
```

## API interne

### Fonctions principales (core.py)

#### `_show_artist_content(self, artist_name, video_data)`
Point d'entrée principal pour afficher le contenu d'un artiste.
- **Paramètres** : `artist_name` (str), `video_data` (dict)
- **Retour** : None
- **Responsabilité** : Initialise l'interface et lance la recherche

#### `_create_artist_tabs(self)`
Crée les onglets Musiques/Sorties/Playlists.
- **Paramètres** : None
- **Retour** : None
- **Responsabilité** : Construction de l'interface à onglets

#### `_search_artist_content_async(self)`
Lance la recherche asynchrone du contenu d'artiste.
- **Paramètres** : None
- **Retour** : None
- **Responsabilité** : Orchestration des recherches parallèles

### Fonctions de recherche

#### Songs (`songs.py`)
- `_search_artist_videos_with_id(self)` - Recherche les vidéos
- `_display_artist_videos(self, videos)` - Affiche les vidéos

#### Releases (`releases.py`)
- `_search_artist_releases_with_id(self)` - Recherche les sorties
- `_display_artist_releases(self, releases)` - Affiche les sorties
- `_return_to_releases(self)` - Retour à la vue des sorties

#### Playlists (`playlists.py`)
- `_search_artist_playlists_with_id(self)` - Recherche les playlists
- `_display_artist_playlists(self, playlists)` - Affiche les playlists
- `_show_playlist_content(self, playlist_data, target_tab)` - Contenu d'une playlist
- `_return_to_playlists(self)` - Retour à la vue des playlists

## Gestion d'état

### Variables d'état principales
Ces variables restent dans la classe `MusicPlayer` principale :

```python
# Mode artiste
self.artist_mode = False
self.current_artist_name = ""
self.current_artist_channel_url = ""
self.current_artist_channel_id = None

# Interface
self.artist_notebook = None
self.artist_tab_back_btn = None

# État des onglets
self.artist_tab_active_sorties = False
self.artist_tab_active_playlists = False

# Threads et cache
self.artist_videos_thread = None
self.artist_releases_thread = None
self.artist_playlists_thread = None
self.artist_cache = {}
self.artist_search_cancelled = False
```

### Gestion des threads
Chaque type de recherche (vidéos, sorties, playlists) utilise son propre thread :
- Recherches parallèles pour optimiser les performances
- Annulation possible via `artist_search_cancelled`
- Cache des résultats pour éviter les recherches répétées

## Intégration avec le lecteur principal

### Gestionnaire centralisé
`ArtistTabManager` fait le lien entre le lecteur principal et le module :

```python
class ArtistTabManager:
    def __init__(self, music_player):
        self.player = music_player
    
    def show_artist_content(self, artist_name, video_data):
        return artist_tab.core._show_artist_content(self.player, artist_name, video_data)
```

### Redirections dans main.py
Toutes les fonctions `_artist_*` dans `main.py` sont des redirections :

```python
def _show_artist_content(self, artist_name, video_data):
    return self.artist_tab_manager.show_artist_content(artist_name, video_data)
```

## Extensibilité

### Ajouter un nouveau type de contenu

1. **Créer le module** (ex: `collaborations.py`)
```python
def _search_artist_collaborations_with_id(self):
    # Implémentation de la recherche
    pass

def _display_artist_collaborations(self, collaborations):
    # Implémentation de l'affichage
    pass
```

2. **Ajouter au gestionnaire** (`artist_tab_manager.py`)
```python
def search_artist_collaborations(self):
    return artist_tab.collaborations._search_artist_collaborations_with_id(self.player)
```

3. **Ajouter la redirection** (`main.py`)
```python
def _search_artist_collaborations(self):
    return self.artist_tab_manager.search_artist_collaborations()
```

### Modifier l'interface

Pour modifier l'apparence des pages d'artiste :
1. **Couleurs et styles** → `config.py` (section `ARTIST_COLORS`)
2. **Dimensions** → `config.py` (section `ARTIST_LAYOUT`)
3. **Messages** → `config.py` (section `ARTIST_MESSAGES`)
4. **Logique d'affichage** → Fichiers spécifiques (`core.py`, `songs.py`, etc.)

## Bonnes pratiques

### Gestion d'erreurs
- Toujours encapsuler dans des try/except
- Utiliser les messages de `config.py`
- Afficher des messages d'erreur utilisateur-friendly

### Performance
- Utiliser le cache (`self.artist_cache`)
- Affichage par lots (`_display_results_in_batches`)
- Threads pour les opérations longues

### Maintenance
- Respecter la séparation des responsabilités
- Utiliser les utilitaires internes (`utils.py`)
- Documenter les nouvelles fonctions
- Tester les modifications avec `test_artist_tab.py`

## Tests et validation

### Script de test
`test_artist_tab.py` valide :
- Imports corrects
- Présence des méthodes attendues
- Fonctionnement du gestionnaire
- Accès aux fonctions dans les sous-modules

### Validation de configuration
`config.py` inclut une fonction `validate_artist_config()` pour vérifier la cohérence de la configuration.

### Tests manuels
1. Lancer l'application
2. Rechercher un artiste
3. Naviguer dans les onglets
4. Tester les playlists
5. Vérifier les boutons de retour